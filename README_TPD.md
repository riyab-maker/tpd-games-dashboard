# TPD Games Dashboard

A Streamlit dashboard for analyzing TPD Games data with optimized deployment for Render.

## ðŸ—ï¸ Architecture

This project uses a **preprocessing architecture** to handle large datasets efficiently on Render's 512MB memory limit:

- **Local Preprocessing**: All data processing happens locally using `preprocess_data_tpd.py`
- **Lightweight Dashboard**: The Streamlit dashboard only handles visualization of preprocessed data
- **TPD-Specific Queries**: Uses filtered queries for TPD Games (custom_dimension_2: 149, 150, 160, 166)

## ðŸ“ Project Structure

```
â”œâ”€â”€ preprocess_data_tpd.py          # TPD data preprocessing script (run locally)
â”œâ”€â”€ src/
â”‚   â””â”€â”€ streamlit_dashboard_tpd.py  # TPD visualization dashboard
â”œâ”€â”€ data/                           # Processed data files (generated by preprocessing)
â”‚   â”œâ”€â”€ processed_data.csv
â”‚   â”œâ”€â”€ summary_data.csv
â”‚   â”œâ”€â”€ score_distribution_data.csv
â”‚   â”œâ”€â”€ time_series_data.csv
â”‚   â”œâ”€â”€ repeatability_data.csv
â”‚   â””â”€â”€ metadata.json
â”œâ”€â”€ tpd_conversion_funnel.csv       # TPD conversion funnel raw data
â”œâ”€â”€ render_tpd.yaml                 # Render deployment configuration
â””â”€â”€ README_TPD.md
```

## ðŸš€ Setup and Deployment

### 1. Local Development

1. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

2. **Set up environment variables** (create `.env` file):
   ```bash
   # Copy from env.template or create new .env file
   REDSHIFT_HOST=your-redshift-host
   REDSHIFT_DATABASE=your-database
   REDSHIFT_PORT=5439
   REDSHIFT_USER=your-username
   REDSHIFT_PASSWORD=your-password
   ```

3. **Ensure TPD conversion funnel CSV exists**:
   - Place `tpd_conversion_funnel.csv` in the root directory

4. **Run preprocessing** (required before deployment):
   ```bash
   python preprocess_data_tpd.py --all
   ```
   
   Or process specific sections:
   ```bash
   python preprocess_data_tpd.py --main --time-series --repeatability --summary --scores --question-correctness --parent-poll
   ```

5. **Run dashboard locally**:
   ```bash
   streamlit run src/streamlit_dashboard_tpd.py
   ```

### 2. GitHub Repository Setup

1. **Create a new repository on GitHub**:
   - Go to GitHub and create a new repository (e.g., `tpd-games-dashboard`)
   - **Do NOT initialize with README, .gitignore, or license** (we'll add our own)

2. **Initialize and push to GitHub**:
   ```bash
   # Initialize git repository
   git init
   
   # Add all TPD-specific files
   git add preprocess_data_tpd.py
   git add src/streamlit_dashboard_tpd.py
   git add render_tpd.yaml
   git add requirements.txt
   git add README_TPD.md
   git add tpd_conversion_funnel.csv
   git add data/*.csv
   git add data/metadata.json
   git add .env.template  # If you have one
   
   # Commit
   git commit -m "Initial commit: TPD Games Dashboard"
   
   # Add remote and push
   git remote add origin https://github.com/YOUR_USERNAME/tpd-games-dashboard.git
   git branch -M main
   git push -u origin main
   ```

### 3. Render Deployment

1. **Create Render Account** (if you don't have one):
   - Go to https://render.com
   - Sign up or log in

2. **Create New Web Service**:
   - Click "New +" â†’ "Web Service"
   - Connect your GitHub account if not already connected
   - Select the `tpd-games-dashboard` repository

3. **Configure Service**:
   - **Name**: `tpd-games-dashboard` (or your preferred name)
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `streamlit run src/streamlit_dashboard_tpd.py --server.port=$PORT --server.address=0.0.0.0`
   - **Plan**: Free (or your preferred plan)

4. **Set Environment Variables**:
   - Go to "Environment" tab
   - Add the following variables:
     ```
     REDSHIFT_HOST=your-redshift-host
     REDSHIFT_DATABASE=your-database
     REDSHIFT_PORT=5439
     REDSHIFT_USER=your-username
     REDSHIFT_PASSWORD=your-password
     PYTHON_VERSION=3.11.0
     ```

5. **Deploy**:
   - Click "Create Web Service"
   - Render will build and deploy your dashboard
   - The dashboard will be available at: `https://tpd-games-dashboard.onrender.com` (or your custom domain)

## ðŸ“Š Data Updates

To update the dashboard data:

1. **Run preprocessing locally**:
   ```bash
   python preprocess_data_tpd.py --all
   ```

2. **Commit and push updated data files**:
   ```bash
   git add data/*.csv
   git commit -m "Update TPD dashboard data"
   git push
   ```

3. **Render will automatically redeploy** when it detects changes

## ðŸ” TPD-Specific Configuration

### Query Filters
- **Time Series**: Filters by `custom_dimension_2 IN ('149','150','160','166')` and `date >= '2026-01-03'`
- **Repeatability**: Same filters as time series

### Game Name Mapping
- `166` â†’ `significance_of_early_years_2`
- `150` â†’ `significance_of_early_years_1`
- `160` â†’ `language_development_1`
- `149` â†’ `redirected to emotional_development`

### Data Sources
- **Conversion Funnel**: `tpd_conversion_funnel.csv`
- **Time Series**: Direct query from Redshift (TPD query)
- **Repeatability**: Direct query from Redshift (TPD query)
- **Scores & Question Correctness**: Same as Hybrid Dashboard
- **Parent Poll**: Same as Hybrid Dashboard

## ðŸ“ Notes

- This dashboard is separate from the Hybrid Dashboard
- Both dashboards can coexist independently
- TPD dashboard uses the same RM active users CSV as Hybrid Dashboard
- Make sure to run preprocessing before deploying to ensure all data files exist

## ðŸ› Troubleshooting

### Dashboard shows "No data available"
- Ensure preprocessing has been run: `python preprocess_data_tpd.py --all`
- Check that CSV files exist in the `data/` directory
- Verify `tpd_conversion_funnel.csv` exists in root directory

### Render deployment fails
- Check that `render_tpd.yaml` is in the repository
- Verify environment variables are set correctly
- Check build logs in Render dashboard for specific errors

### Query returns no results
- Verify date filter (should be >= 2026-01-03)
- Check that custom_dimension_2 values (149, 150, 160, 166) exist in database
- Verify Redshift connection credentials
