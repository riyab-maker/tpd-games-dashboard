# TPD Games Dashboard Setup Guide

## Overview

The TPD Games Dashboard is a separate dashboard from the Hybrid Dashboard, specifically configured for TPD Games data. It uses different queries and data sources while maintaining the same structure and visualizations.

## Key Differences from Hybrid Dashboard

### 1. Data Sources
- **Conversion Funnel**: Uses `tpd_conversion_funnel.csv` instead of `conversion_funnel.csv`
- **Time Series**: Uses TPD-specific query (filters: custom_dimension_2 IN (149, 150, 160, 166), date >= 2025-01-03)
- **Repeatability**: Uses TPD-specific query (same filters as time series)
- **Scores & Question Correctness**: Uses same data as Hybrid Dashboard
- **Parent Poll**: Uses same data as Hybrid Dashboard

### 2. Queries
- **Time Series Query**: 
  - Filters by `custom_dimension_2 IN ('149','150','160','166')`
  - Date filter: `server_time >= '2025-01-03'`
  - Uses simpler pattern matching (`%game_started%` instead of `%hybrid_game_started%`)
  - No game tables or unmapped game mappings
  - Direct CASE statement for game name mapping

- **Repeatability Query**:
  - Same filters as time series
  - No normalization logic
  - No game tables
  - Direct CASE statement for game name mapping

### 3. Game Name Mapping
The TPD queries map activity IDs to game names:
- `166` → `significance_of_early_years_2`
- `150` → `significance_of_early_years_1`
- `160` → `language_development_1`
- `149` (else) → `redirected to emotional_development`

## Files Created

1. **preprocess_data_tpd.py** - TPD-specific preprocessing script
   - Uses TPD time series query
   - Uses TPD repeatability query
   - Loads from `tpd_conversion_funnel.csv`

2. **src/streamlit_dashboard_tpd.py** - TPD dashboard application
   - Title: "TPD Games Dashboard"
   - Loads from `tpd_conversion_funnel.csv`
   - Uses same visualization functions as Hybrid Dashboard

3. **TPD_TIME_SERIES_QUERY.sql** - TPD time series SQL query
4. **TPD_REPEATABILITY_QUERY.sql** - TPD repeatability SQL query

## Setup Instructions

### 1. Preprocess Data

Run the TPD preprocessing script to generate data files:

```bash
python preprocess_data_tpd.py --all
```

Or process specific sections:
```bash
python preprocess_data_tpd.py --main --time-series --repeatability --summary --scores --question-correctness --parent-poll
```

This will generate CSV files in the `data/` directory:
- `summary_data.csv`
- `game_conversion_numbers.csv`
- `time_series_data.csv`
- `repeatability_data.csv`
- `score_distribution_data.csv`
- `question_correctness_data.csv`
- `poll_responses_data.csv`
- `video_viewership_data.csv`

### 2. Run Dashboard Locally

```bash
streamlit run src/streamlit_dashboard_tpd.py
```

### 3. Deploy to Render

1. Create a new GitHub repository for TPD Games Dashboard
2. Push the TPD-specific files to the repository
3. Create a new Render service pointing to the TPD repository
4. Configure environment variables (same as Hybrid Dashboard)
5. Set the start command: `streamlit run src/streamlit_dashboard_tpd.py --server.port=$PORT --server.address=0.0.0.0`

## Required Files

Make sure these files are in the repository:
- `preprocess_data_tpd.py`
- `src/streamlit_dashboard_tpd.py`
- `tpd_conversion_funnel.csv` (in root or data/ directory)
- `requirements.txt`
- `render.yaml` (if using Render)
- All data CSV files in `data/` directory (generated by preprocessing)

## Notes

- The Hybrid Dashboard remains unchanged and unaffected
- Both dashboards can coexist in separate repositories
- TPD dashboard uses the same RM active users CSV as Hybrid Dashboard
- Scores, question correctness, and parent poll sections use the same data/logic as Hybrid Dashboard
